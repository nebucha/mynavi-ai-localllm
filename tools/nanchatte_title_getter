#!/bin/sh
#
# 指定されたコンテンツ（HTMLを想定）からなんとなくタイトルを
# 推測して取り出すコマンド

# 1:日付

tmp=/tmp/$$
PATH=$(dirname $0):$PATH

#################################################################
# タイトルを取り出す
#################################################################
cat								|
# titleタグを正確に取り出したいのでいったん改行コードを削除して
# からtitleタグの部分のみを取り出す
tr	-d '\n'							|
tr	-d '\r'							|
gsed	's,<title>,\n<title>,'					|
gsed	's,</title>,\n,'					|
gsed	's,<TITLE>,\n<title>,'					|
gsed	's,</TITLE>,\n,'					|
grep	'^<title>'						|
gsed	's/^<title>//'						|
head	-1							|
# コメントが含まれている場合には削除
sed	's/\(<!--.*-->\)//'					|
# |はMYNAVI CMS的にも問題を引き起こしやすいので、これを｜に変換
# するとともに、後でsedのセパレータとして|を利用できるようにする
sed	"s/ | /｜/g"						|
sed	"s/|/｜/g"						|
# アンパサンド変換まえの特殊文字多重変換回避処理
sed	-e 's/&lt;/</g'		-e 's/&gt;/>/g'			|
sed	-e 's/&laquo;/≪/g'	-e 's/&raquo;/≫/g'		|
sed	-e 's/&#171;/≪/g'	-e 's/&#187;/≫/g'		|
sed	-e 's/&#8220;/“/g'	-e 's/&#8221;/”/g'		|
sed	-e "s/&#039;/'/g"	-e 's/&#034;/"/g'		|
sed	-e 's/&quot;/"/g'					|
sed	-e 's/&#150;/-/g'	-e 's/&#151;/ー/g'		|
sed	-e 's/&ndash;/-/g'	-e 's/&#8211;/-/g'		|
sed	-e 's/&mdash;/-/g'	-e 's/&#x2014;/—/g'		|
sed	-e 's/&#169;/©/g'	-e 's/&#174;/®/g'		|
sed	-e 's/&nbsp;/ /g'					|
# アンパサンドは「&amp;」に揃える
sed	"s/&amp;/\&/g"						|
sed	"s/&#x26;/\&/g"						|
sed	"s/&#38;/\&/g"						|
sed	"s/&#038;/\&/g"						|
sed	"s/&/\&amp;/g"						|
# <>を&lt;&gt;へ変換
sed	"s/</\&lt;/g"						|
sed	"s/>/\&gt;/g"						|
# ダブルクォーテーションを&quot;へ変換
sed	's/"/\&quot;/g'						|
# 前後の不要なスペースやタブを削除
sed	"s/^[ 	]*//g"						|
sed	"s/[ 	]*$//g"						|
cat

rm	-f $tmp-*
